{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/xi-zhao/pptx-ooxml-engine/schemas/ops.v1.json",
  "title": "pptx-ooxml-engine operations v1",
  "type": "object",
  "required": ["operations"],
  "$defs": {
    "paragraph": {
      "type": "object",
      "required": ["text"],
      "properties": {
        "text": { "type": "string" },
        "level": { "type": "integer", "minimum": 0, "maximum": 8 },
        "list_type": { "type": "string", "enum": ["none", "bullet", "number"] },
        "font_size_pt": { "type": "number", "exclusiveMinimum": 0 },
        "bold": { "type": "boolean" },
        "italic": { "type": "boolean" },
        "color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" },
        "alignment": { "type": "string", "enum": ["left", "center", "right", "justify"] },
        "line_spacing": { "type": "number", "exclusiveMinimum": 0 },
        "space_before_pt": { "type": "number", "minimum": 0 },
        "space_after_pt": { "type": "number", "minimum": 0 }
      },
      "additionalProperties": false
    },
    "chart_series": {
      "type": "object",
      "required": ["name", "values"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "values": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "number" }
        }
      },
      "additionalProperties": false
    }
  },
  "properties": {
    "template_pptx": {
      "type": "string",
      "minLength": 1,
      "description": "Master/layout template PPTX path."
    },
    "reuse_slide_libraries": {
      "type": "array",
      "description": "Optional reusable slide library PPTX paths.",
      "items": { "type": "string", "minLength": 1 }
    },
    "operations": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "type": "object",
            "required": ["op", "source_slide_index"],
            "properties": {
              "op": { "const": "copy_slide" },
              "source_path": { "type": "string", "minLength": 1 },
              "reuse_library_index": { "type": "integer", "minimum": 0 },
              "source_slide_index": { "type": "integer", "minimum": 0 },
              "mode": { "type": "string", "enum": ["shape", "part"] }
            },
            "anyOf": [
              { "required": ["source_path"] },
              { "required": ["reuse_library_index"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op"],
            "properties": {
              "op": { "const": "create_slide_on_layout" },
              "layout_index": { "type": "integer", "minimum": 0 },
              "title": { "type": "string" },
              "body": { "type": "string" }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "find", "replace"],
            "properties": {
              "op": { "const": "rewrite_text" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "find": { "type": "string" },
              "replace": { "type": "string" },
              "shape_name": { "type": "string" },
              "occurrence": { "type": "string", "enum": ["first", "all"] }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index"],
            "properties": {
              "op": { "const": "delete_slide" },
              "slide_index": { "type": "integer", "minimum": 0 }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "from_index", "to_index"],
            "properties": {
              "op": { "const": "move_slide" },
              "from_index": { "type": "integer", "minimum": 0 },
              "to_index": { "type": "integer", "minimum": 0 }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op"],
            "properties": {
              "op": { "const": "set_slide_size" },
              "preset": { "type": "string", "enum": ["16:9", "4:3"] },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 }
            },
            "anyOf": [
              { "required": ["preset"] },
              { "required": ["width_inches", "height_inches"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "layout_index"],
            "properties": {
              "op": { "const": "set_slide_layout" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "layout_index": { "type": "integer", "minimum": 0 }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "text"],
            "properties": {
              "op": { "const": "set_notes" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "text": { "type": "string" }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "x_inches", "y_inches", "width_inches", "height_inches"],
            "properties": {
              "op": { "const": "add_textbox" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "x_inches": { "type": "number", "minimum": 0 },
              "y_inches": { "type": "number", "minimum": 0 },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 },
              "name": { "type": "string" },
              "text": { "type": "string" },
              "paragraphs": {
                "type": "array",
                "items": { "$ref": "#/$defs/paragraph" }
              },
              "vertical_anchor": { "type": "string", "enum": ["top", "middle", "bottom"] },
              "word_wrap": { "type": "boolean" }
            },
            "anyOf": [
              { "required": ["text"] },
              { "required": ["paragraphs"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index"],
            "properties": {
              "op": { "const": "set_shape_text" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_name": { "type": "string" },
              "shape_index": { "type": "integer", "minimum": 0 },
              "text": { "type": "string" },
              "paragraphs": {
                "type": "array",
                "items": { "$ref": "#/$defs/paragraph" }
              },
              "vertical_anchor": { "type": "string", "enum": ["top", "middle", "bottom"] },
              "word_wrap": { "type": "boolean" }
            },
            "allOf": [
              {
                "anyOf": [
                  { "required": ["shape_name"] },
                  { "required": ["shape_index"] }
                ]
              },
              {
                "anyOf": [
                  { "required": ["text"] },
                  { "required": ["paragraphs"] }
                ]
              }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "image_path", "x_inches", "y_inches", "width_inches", "height_inches"],
            "properties": {
              "op": { "const": "add_image" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "image_path": { "type": "string", "minLength": 1 },
              "x_inches": { "type": "number", "minimum": 0 },
              "y_inches": { "type": "number", "minimum": 0 },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 },
              "fit": { "type": "string", "enum": ["stretch", "contain", "cover"] },
              "name": { "type": "string" }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "shape_type", "x_inches", "y_inches", "width_inches", "height_inches"],
            "properties": {
              "op": { "const": "add_shape" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_type": { "type": "string", "enum": ["rect", "round_rect", "ellipse", "right_arrow", "line"] },
              "x_inches": { "type": "number", "minimum": 0 },
              "y_inches": { "type": "number", "minimum": 0 },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 },
              "name": { "type": "string" },
              "text": { "type": "string" },
              "fill_color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" },
              "line_color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" },
              "line_width_pt": { "type": "number", "exclusiveMinimum": 0 },
              "text_color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" },
              "font_size_pt": { "type": "number", "exclusiveMinimum": 0 }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "x_inches", "y_inches", "width_inches", "height_inches", "data"],
            "properties": {
              "op": { "const": "add_table" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "x_inches": { "type": "number", "minimum": 0 },
              "y_inches": { "type": "number", "minimum": 0 },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 },
              "data": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "array",
                  "minItems": 1,
                  "items": { "type": "string" }
                }
              },
              "header": { "type": "boolean" },
              "name": { "type": "string" },
              "font_size_pt": { "type": "number", "exclusiveMinimum": 0 }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "color_hex"],
            "properties": {
              "op": { "const": "set_slide_background" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index"],
            "properties": {
              "op": { "const": "fill_placeholder" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "placeholder_idx": { "type": "integer", "minimum": 0 },
              "placeholder_type": { "type": "string", "enum": ["title", "body", "subtitle", "picture", "object"] },
              "text": { "type": "string" },
              "paragraphs": {
                "type": "array",
                "items": { "$ref": "#/$defs/paragraph" }
              },
              "image_path": { "type": "string", "minLength": 1 }
            },
            "allOf": [
              {
                "anyOf": [
                  { "required": ["placeholder_idx"] },
                  { "required": ["placeholder_type"] }
                ]
              },
              {
                "anyOf": [
                  { "required": ["text"] },
                  { "required": ["paragraphs"] },
                  { "required": ["image_path"] }
                ]
              }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index"],
            "properties": {
              "op": { "const": "set_shape_geometry" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_name": { "type": "string" },
              "shape_index": { "type": "integer", "minimum": 0 },
              "x_inches": { "type": "number", "minimum": 0 },
              "y_inches": { "type": "number", "minimum": 0 },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 }
            },
            "allOf": [
              {
                "anyOf": [
                  { "required": ["shape_name"] },
                  { "required": ["shape_index"] }
                ]
              },
              {
                "anyOf": [
                  { "required": ["x_inches"] },
                  { "required": ["y_inches"] },
                  { "required": ["width_inches"] },
                  { "required": ["height_inches"] }
                ]
              }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "action"],
            "properties": {
              "op": { "const": "set_shape_z_order" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_name": { "type": "string" },
              "shape_index": { "type": "integer", "minimum": 0 },
              "action": { "type": "string", "enum": ["bring_to_front", "send_to_back", "bring_forward", "send_backward"] }
            },
            "anyOf": [
              { "required": ["shape_name"] },
              { "required": ["shape_index"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "chart_type", "x_inches", "y_inches", "width_inches", "height_inches", "categories", "series"],
            "properties": {
              "op": { "const": "add_chart" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "chart_type": { "type": "string", "enum": ["column_clustered", "line", "pie"] },
              "x_inches": { "type": "number", "minimum": 0 },
              "y_inches": { "type": "number", "minimum": 0 },
              "width_inches": { "type": "number", "exclusiveMinimum": 0 },
              "height_inches": { "type": "number", "exclusiveMinimum": 0 },
              "categories": {
                "type": "array",
                "minItems": 1,
                "items": { "type": "string" }
              },
              "series": {
                "type": "array",
                "minItems": 1,
                "items": { "$ref": "#/$defs/chart_series" }
              },
              "name": { "type": "string" }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index"],
            "properties": {
              "op": { "const": "set_table_cell" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "table_name": { "type": "string" },
              "table_index": { "type": "integer", "minimum": 0 },
              "row": { "type": "integer", "minimum": 0 },
              "col": { "type": "integer", "minimum": 0 },
              "text": { "type": "string" },
              "bold": { "type": "boolean" },
              "italic": { "type": "boolean" },
              "font_size_pt": { "type": "number", "exclusiveMinimum": 0 },
              "text_color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" },
              "fill_color_hex": { "type": "string", "pattern": "^#?[0-9A-Fa-f]{6}$" },
              "alignment": { "type": "string", "enum": ["left", "center", "right", "justify"] }
            },
            "allOf": [
              {
                "anyOf": [
                  { "required": ["table_name"] },
                  { "required": ["table_index"] }
                ]
              },
              {
                "required": ["row", "col"]
              }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "start_row", "start_col", "end_row", "end_col"],
            "properties": {
              "op": { "const": "merge_table_cells" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "table_name": { "type": "string" },
              "table_index": { "type": "integer", "minimum": 0 },
              "start_row": { "type": "integer", "minimum": 0 },
              "start_col": { "type": "integer", "minimum": 0 },
              "end_row": { "type": "integer", "minimum": 0 },
              "end_col": { "type": "integer", "minimum": 0 }
            },
            "anyOf": [
              { "required": ["table_name"] },
              { "required": ["table_index"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "url"],
            "properties": {
              "op": { "const": "set_shape_hyperlink" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_name": { "type": "string" },
              "shape_index": { "type": "integer", "minimum": 0 },
              "url": { "type": "string", "minLength": 1 }
            },
            "anyOf": [
              { "required": ["shape_name"] },
              { "required": ["shape_index"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "image_path"],
            "properties": {
              "op": { "const": "replace_image" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_name": { "type": "string" },
              "shape_index": { "type": "integer", "minimum": 0 },
              "image_path": { "type": "string", "minLength": 1 },
              "fit": { "type": "string", "enum": ["stretch", "contain", "cover"] }
            },
            "anyOf": [
              { "required": ["shape_name"] },
              { "required": ["shape_index"] }
            ],
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "shape_names", "align"],
            "properties": {
              "op": { "const": "align_shapes" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_names": {
                "type": "array",
                "minItems": 2,
                "items": { "type": "string", "minLength": 1 }
              },
              "align": { "type": "string", "enum": ["left", "center", "right", "top", "middle", "bottom"] },
              "reference": { "type": "string", "enum": ["first", "slide"] }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": ["op", "slide_index", "shape_names", "direction"],
            "properties": {
              "op": { "const": "distribute_shapes" },
              "slide_index": { "type": "integer", "minimum": 0 },
              "shape_names": {
                "type": "array",
                "minItems": 3,
                "items": { "type": "string", "minLength": 1 }
              },
              "direction": { "type": "string", "enum": ["horizontal", "vertical"] }
            },
            "additionalProperties": false
          }
        ]
      }
    }
  },
  "additionalProperties": false
}
